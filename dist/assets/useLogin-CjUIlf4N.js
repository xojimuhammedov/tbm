import{a as l,l as A,p as y,m as N,P as O,o as P,q as v,s as w,i as R,d as q,v as L,r as m}from"./index-ADhmmBpU.js";import{u as M,a as I}from"./useMutate-B2j67kPQ.js";import{M as K}from"./MutateRequestMethod-D0dsk-6r.js";import{o as _,s as p,a as b}from"./zod-BQt-Wj8X.js";import{l as r}from"./lodash-BI9_Ro3R.js";import{u as x}from"./useGetOne-DA0KuYmv.js";import{u as C}from"./button-Bp2lHjov-bkEUXTzY.js";const D=e=>_({email:p().nonempty(e("required {{field}}",{field:e("Username"),ns:l.LANG.NS.VALIDATION})),password:p().nonempty(e("required {{field}}",{field:e("Password"),ns:l.LANG.NS.VALIDATION}))}),G=A()(y(e=>({setPasswordToken:t=>{e({passwordToken:t})},passwordToken:null}),{name:O,storage:N(()=>P(1/24/12))})),d="users",f="profile",z=()=>{const{t:e}=C(["common","ERROR","validation"]),{toast:t}=v(),{accessToken:n,setAccessToken:a,setRefreshToken:u}=w(),g=R(),{setMe:i}=q(),{setPasswordToken:S}=G(),T=L(),h=m.useMemo(()=>D(e),[e]),E=M({resolver:b(h),defaultValues:{email:"",password:""}}),o=x({url:[d,f],options:{enabled:!1}}),k=s=>{a((s==null?void 0:s.token)||null),u((s==null?void 0:s.refresh_token)||null),o.refetch()},{query:c}=I({url:["auth","login"],method:K.POST,options:{onSuccess:k,onError:s=>{t({variant:"destructive",title:e(`${r.get(s,"response.statusText","Error")}`),description:e(`${r.get(s,"response.data.message","An error occurred. Contact the administrator")}`)})}}});return m.useEffect(()=>{n&&o.data&&i(r.get(o.data,"user",null))},[o.data,n]),{form:E,onSubmit:s=>{c.mutate(s)},logout:()=>{a(null),u(null),i(null),S(null),T.removeQueries({queryKey:[d,f]}),g("/auth")},loading:c.isPending}};export{z as u};
